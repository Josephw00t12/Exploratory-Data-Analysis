FA3 Espiritu, Clores
================
Espiritu, Joseph Raphael, Harneyyer, Clores
2026-02-22

``` r
library(arrow)
```

    ## 
    ## Attaching package: 'arrow'

    ## The following object is masked from 'package:utils':
    ## 
    ##     timestamp

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.4

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ lubridate::duration() masks arrow::duration()
    ## ✖ dplyr::filter()       masks stats::filter()
    ## ✖ dplyr::lag()          masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(broom)
library(modelr)
```

    ## 
    ## Attaching package: 'modelr'
    ## 
    ## The following object is masked from 'package:broom':
    ## 
    ##     bootstrap

``` r
library(robustbase)
library(lubridate)
library(purrr)
```

``` r
# ---------------------------------------
# 1️ Load parquet files (Full 2023 Data)
# ---------------------------------------

taxi <- open_dataset("data")

# ---------------------------------------
# 2️ Filter valid trips (Arrow stage)
# ---------------------------------------
taxi_clean <- taxi %>%
  filter(trip_distance > 0,
         total_amount > 0) %>%
  select(trip_distance,
         total_amount,
         tpep_pickup_datetime,
         tpep_dropoff_datetime) %>%
  collect()

# ---------------------------------------
# 3️ Create required variables (In memory)
# ---------------------------------------
taxi_clean <- taxi_clean %>%
  mutate(
    trip_duration_minutes =
      as.numeric(difftime(tpep_dropoff_datetime,
                          tpep_pickup_datetime,
                          units = "mins")),
    
    fare_per_mile =
      total_amount / trip_distance,
    
    month =
      factor(lubridate::month(tpep_pickup_datetime))
  )

# ---------------------------------------
# 4️ Remove extreme outliers (top 1%)
# ---------------------------------------
q_dist <- quantile(taxi_clean$trip_distance, 0.99)
q_fare <- quantile(taxi_clean$total_amount, 0.99)

taxi_trimmed <- taxi_clean %>%
  filter(trip_distance <= q_dist,
         total_amount <= q_fare)

# ---------------------------------------
# 5️ Create modeling sample (for speed)
# ---------------------------------------
set.seed(123)

taxi_model <- taxi_trimmed %>%
  sample_n(200000)

# ---------------------------------------
# 6️ Summary statistics (on modeling data)
# ---------------------------------------
summary(taxi_model)
```

    ##  trip_distance     total_amount    tpep_pickup_datetime            
    ##  Min.   : 0.010   Min.   :  1.00   Min.   :2023-01-01 08:08:05.00  
    ##  1st Qu.: 1.080   1st Qu.: 15.96   1st Qu.:2023-04-02 19:54:04.50  
    ##  Median : 1.800   Median : 21.00   Median :2023-06-26 21:46:56.50  
    ##  Mean   : 3.236   Mean   : 27.49   Mean   :2023-07-02 14:12:58.42  
    ##  3rd Qu.: 3.330   3rd Qu.: 30.20   3rd Qu.:2023-10-06 09:11:01.75  
    ##  Max.   :20.300   Max.   :103.91   Max.   :2024-01-01 07:58:47.00  
    ##                                                                    
    ##  tpep_dropoff_datetime            trip_duration_minutes fare_per_mile      
    ##  Min.   :2023-01-01 08:14:07.00   Min.   : -46.217      Min.   :    0.051  
    ##  1st Qu.:2023-04-02 20:10:21.50   1st Qu.:   7.683      1st Qu.:    8.321  
    ##  Median :2023-06-26 21:54:17.50   Median :  12.567      Median :   11.403  
    ##  Mean   :2023-07-02 14:30:02.25   Mean   :  17.064      Mean   :   16.852  
    ##  3rd Qu.:2023-10-06 09:28:27.50   3rd Qu.:  20.250      3rd Qu.:   15.480  
    ##  Max.   :2024-01-01 08:16:47.00   Max.   :2658.850      Max.   :10380.000  
    ##                                                                            
    ##      month      
    ##  5      :18281  
    ##  10     :18152  
    ##  3      :17869  
    ##  12     :17815  
    ##  4      :17660  
    ##  6      :17555  
    ##  (Other):92668

``` r
# ---------------------------------------
# 7️ Scatterplot (use sample to avoid slow plotting)
# ---------------------------------------
ggplot(taxi_model,
       aes(trip_distance, total_amount)) +
  geom_point(alpha = 0.1) +
  labs(title = "Total Amount vs Trip Distance (2023)",
       x = "Trip Distance (Miles)",
       y = "Total Amount ($)")
```

![](FA3-Espiritu,-Clores_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

The majority of taxi trips are short-distance rides, resulting in a
right-skewed distribution for both trip distance and total fare. The
mean exceeding the median further confirms the presence of long-distance
extreme values.

The scatterplot reveals a strong positive relationship between trip
distance and total fare. As trip distance increases, total fare
increases consistently. However, the spread of total fare becomes wider
at larger distances. Additionally, horizontal clustering around higher
fare values suggests structured pricing patterns such as airport flat
fares.

``` r
lm_model <- lm(total_amount ~ trip_distance,
               data = taxi_model)

summary(lm_model)
```

    ## 
    ## Call:
    ## lm(formula = total_amount ~ trip_distance, data = taxi_model)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -101.996   -3.228   -0.969    2.156   91.192 
    ## 
    ## Coefficients:
    ##                Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)   12.561587   0.019067   658.8   <2e-16 ***
    ## trip_distance  4.613976   0.003769  1224.1   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 6.554 on 199998 degrees of freedom
    ## Multiple R-squared:  0.8823, Adjusted R-squared:  0.8823 
    ## F-statistic: 1.499e+06 on 1 and 199998 DF,  p-value: < 2.2e-16

``` r
coef(lm_model)
```

    ##   (Intercept) trip_distance 
    ##     12.561587      4.613976

``` r
summary(lm_model)$r.squared
```

    ## [1] 0.8822506

If slope ≈ 4.62:

For every additional mile traveled, total taxi fare increases by
approximately \$4.62 on average.

Intercept:

The intercept represents the predicted fare when distance is zero. This
approximates the base fare.

The model explains X% of the variation in total_amount using
trip_distance alone.

``` r
augment(lm_model) %>%
  ggplot(aes(.fitted, .resid)) +
  geom_point(alpha = 0.2) +
  geom_hline(yintercept = 0, color = "red") +
  labs(title = "Residuals vs Fitted",
       x = "Fitted Values",
       y = "Residuals")
```

![](FA3-Espiritu,-Clores_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

Linearity:

Relationship appears mostly linear.

Heteroskedasticity:

Residual spread increases at higher fitted values, indicating
non-constant variance.

``` r
loess_model <- loess(total_amount ~ trip_distance,
                     data = taxi_model,
                     span = 0.3)

ggplot(taxi_model,
       aes(trip_distance, total_amount)) +
  geom_point(alpha = 0.05) +
  geom_smooth(method = "lm", color = "blue", se = FALSE) +
  geom_smooth(method = "loess", color = "red", se = FALSE) +
  labs(title = "Linear vs Flexible (LOESS) Model")
```

    ## `geom_smooth()` using formula = 'y ~ x'
    ## `geom_smooth()` using formula = 'y ~ x'

![](FA3-Espiritu,-Clores_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

``` r
library(modelr)

lm_rmse <- rmse(lm_model, taxi_model)
loess_rmse <- rmse(loess_model, taxi_model)

lm_rmse
```

    ## [1] 6.554289

``` r
loess_rmse
```

    ## [1] 6.188185

If LOESS RMSE slightly smaller:

Flexible modeling captures mild curvature in fare pricing and improves
prediction accuracy.

``` r
taxi_model <- taxi_model %>%
  mutate(cooks = cooks.distance(lm_model))

top10 <- taxi_model %>%
  arrange(desc(cooks)) %>%
  slice(1:10)

top10
```

    ## # A tibble: 10 × 8
    ##    trip_distance total_amount tpep_pickup_datetime tpep_dropoff_datetime
    ##            <dbl>        <dbl> <dttm>               <dttm>               
    ##  1          20.2         7    2023-04-09 02:55:07  2023-04-09 02:55:39  
    ##  2          19.7         2    2023-11-11 11:39:56  2023-11-11 12:17:25  
    ##  3          19.6         1    2023-06-04 03:16:46  2023-06-04 03:18:02  
    ##  4          19.9         4.65 2023-07-15 07:01:22  2023-07-15 07:01:49  
    ##  5          18.4         1.5  2023-11-08 12:19:43  2023-11-08 12:52:03  
    ##  6          18.6         7    2023-07-18 01:22:18  2023-07-18 01:22:25  
    ##  7          17.2         4.5  2023-03-09 20:29:45  2023-03-09 20:29:48  
    ##  8          16.4         4.5  2023-12-12 20:57:02  2023-12-12 20:57:07  
    ##  9          20          39.9  2023-12-30 20:15:47  2023-12-30 21:58:07  
    ## 10          17.5        33    2023-10-25 15:33:55  2023-10-25 16:55:44  
    ## # ℹ 4 more variables: trip_duration_minutes <dbl>, fare_per_mile <dbl>,
    ## #   month <fct>, cooks <dbl>

``` r
library(robustbase)

robust_model <- lmrob(total_amount ~ trip_distance,
                      data = taxi_model)

summary(robust_model)
```

    ## 
    ## Call:
    ## lmrob(formula = total_amount ~ trip_distance, data = taxi_model)
    ##  \--> method = "MM"
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -104.326   -2.466   -0.237    2.764   92.305 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)   11.44752    0.02057   556.6   <2e-16 ***
    ## trip_distance  4.78970    0.01065   449.7   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Robust residual standard error: 3.762 
    ## Multiple R-squared:  0.9375, Adjusted R-squared:  0.9375 
    ## Convergence in 35 IRWLS iterations
    ## 
    ## Robustness weights: 
    ##  4798 observations c(37,55,95,104,148,180,274,278,279,312,357,388,390,519,632,636,716,748,796,902,967,980,987,1010,1102,1155,1169,1183,1194,1252,1275,1291,1302,1346,1458,1491,1504,1655,1677,1691,1710,1758,1835,1866,1908,2012,2040,2060,2176,2219,2227,2256,2300,2357,2375,2448,2617,2624,2630,2723,2728,2765,2832,2865,2905,2967,3089,3197,3210,3211,3214,3234,3264,3298,3407,3455,3491,3497,3529,3600,3610,3644,3674,3757,3794,3802,3827,3986,3995,4024,4062,4090,4250,4261,4324,4391,4423,4452,4590,4667,4669,4714,4793,4794,4796,4820,4848,4853,4919,4964,5057,5066,5145,5149,5158,5202,5241,5265,5298,5394,5431,5451,5454,5461,5477,5491,5492,5511,5557,5565,5589,5692,5798,5841,5891,6043,6048,6122,6180,6295,6316,6360,6391,6448,6458,6484,6497,6555,6599,6748,6750,6759,6834,6879,6911,6924,6931,6933,6972,7032,7043,7063,7070,7079,7089,7128,7182,7183,7212,7261,7312,7339,7362,7572,7593,7632,7640,7661,7919,7930,7959,8032,8055,8099,8105,8160,8170,8228,8253,8313,8386,8388,8446,8481,8532,8534,8536,8540,8657,8669,8692,8737,8782,8839,8876,9085,9112,9283,9289,9316,9353,9394,9469,9507,9542,9577,9622,9650,9708,9719,9761,9814,9832,9883,9927,9952,9957,9960,10004,10037,10067,10083,10106,10117,10125,10128,10212,10226,10243,10276,10287,10317,10412,10448,10472,10500,10592,10603,10607,10610,10660,10684,10719,10822,10835,10862,10890,10897,10938,10960,10983,10997,11031,11039,11121,11131,11164,11249,11319,11403,11422,11572,11579,11647,11785,11800,11803,11873,11965,11982,11995,12009,12079,12090,12120,12178,12198,12217,12225,12259,12305,12345,12410,12457,12499,12506,12508,12533,12536,12545,12551,12666,12678,12815,12858,12860,12876,12914,12944,12950,12981,12998,13027,13030,13096,13148,13272,13324,13348,13414,13554,13565,13601,13629,13635,13663,13696,13712,13737,13756,13783,13807,13917,13945,14027,14110,14149,14209,14210,14233,14235,14264,14331,14376,14513,14530,14649,14706,14863,14869,14884,14936,15034,15163,15189,15227,15319,15390,15511,15595,15631,15862,15947,15997,16061,16070,16128,16165,16227,16231,16232,16250,16307,16392,16393,16396,16412,16443,16534,16574,16609,16706,16830,16885,16973,17031,17046,17181,17242,17340,17348,17394,17497,17498,17512,17597,17704,17705,17791,17852,17909,17945,17951,17975,17984,18008,18019,18095,18126,18142,18252,18303,18305,18434,18700,18714,18761,18798,18827,18961,18981,19064,19080,19164,19195,19197,19231,19261,19269,19293,19414,19533,19574,19616,19654,19676,19708,19714,19809,19820,19832,19839,19864,19865,19939,19967,19974,19984,20161,20188,20214,20295,20332,20436,20556,20591,20616,20618,20706,20777,20791,20836,20839,20864,20885,20888,20939,20951,21070,21176,21241,21426,21440,21448,21472,21476,21635,21641,21726,21734,21775,21784,21815,21825,21828,21845,21847,21867,21915,21951,21960,21963,21981,21988,21993,22008,22128,22165,22169,22189,22275,22335,22422,22455,22567,22608,22615,22618,22664,22682,22714,22730,22772,22787,22820,22855,22877,22926,22972,22995,23012,23014,23018,23133,23192,23282,23303,23324,23333,23367,23421,23436,23463,23527,23590,23643,23706,23824,23897,23960,24014,24017,24025,24032,24042,24072,24121,24193,24217,24233,24248,24280,24335,24346,24351,24373,24400,24470,24492,24521,24549,24649,24667,24704,24764,24826,24907,24923,24976,24992,25060,25094,25105,25206,25251,25263,25279,25325,25352,25426,25457,25468,25525,25563,25590,25702,25703,25720,25756,25769,25824,25850,25934,25936,25949,26031,26049,26128,26152,26224,26252,26338,26350,26363,26382,26385,26426,26440,26481,26544,26589,26629,26672,26718,26734,26740,26753,26770,26833,26852,26866,26884,26941,26944,26946,26967,26970,27046,27073,27103,27130,27193,27223,27224,27288,27305,27336,27346,27414,27462,27475,27556,27635,27707,27753,27767,27769,27850,27861,27906,27920,28006,28116,28170,28172,28320,28334,28364,28377,28444,28491,28546,28637,28658,28668,28706,28753,28852,28955,29014,29015,29024,29051,29055,29056,29168,29178,29326,29346,29411,29512,29528,29534,29536,29569,29572,29589,29611,29615,29638,29657,29676,29677,29688,29696,29781,29846,29874,29894,29934,29957,30109,30145,30171,30187,30246,30305,30353,30369,30416,30417,30466,30501,30551,30558,30594,30633,30670,30732,30797,30825,30856,30937,30946,30983,31021,31046,31076,31138,31165,31205,31207,31315,31329,31337,31453,31546,31550,31566,31586,31596,31673,31676,31789,31816,31868,31885,31918,31926,31966,31975,32008,32086,32162,32176,32230,32285,32306,32440,32535,32610,32660,32663,32692,32724,32807,32861,32919,32971,33035,33049,33204,33209,33249,33284,33297,33311,33327,33331,33394,33457,33487,33497,33665,33802,33819,33918,33936,34034,34054,34284,34293,34296,34309,34341,34352,34379,34397,34411,34461,34482,34519,34530,34547,34559,34577,34694,34705,34708,34804,34844,34893,34895,34957,35056,35138,35172,35189,35242,35254,35256,35318,35357,35380,35398,35415,35432,35436,35599,35604,35618,35653,35764,35799,35828,35916,35917,36043,36068,36156,36273,36332,36354,36447,36526,36663,36722,36739,36771,36783,36803,36816,36818,36928,37044,37133,37215,37241,37341,37387,37445,37471,37520,37594,37615,37693,37707,37733,37787,37847,37867,37969,38080,38099,38206,38213,38248,38305,38331,38386,38403,38433,38504,38528,38563,38581,38651,38682,38725,38812,38830,38910,38989,38998,39005,39016,39111,39123,39134,39192,39249,39264,39297,39320,39363,39484,39486,39501,39655,39720,39721,39760,39821,39844,39869,39937,40008,40182,40227,40237,40249,40334,40351,40374,40384,40398,40464,40478,40515,40565,40679,40689,40722,40783,40824,40903,40910,40912,40944,40952,40986,40987,41001,41099,41108,41114,41164,41202,41205,41236,41249,41346,41373,41385,41460,41477,41501,41507,41514,41526,41544,41604,41682,41704,41751,41865,41950,41954,42021,42036,42042,42101,42111,42180,42215,42223,42271,42276,42314,42360,42368,42435,42449,42506,42515,42539,42614,42704,42725,42784,42805,42821,42865,42882,42931,42959,42967,42971,42972,42989,43036,43047,43077,43092,43133,43134,43179,43200,43220,43290,43296,43393,43423,43446,43451,43467,43480,43489,43514,43527,43678,43694,43710,43720,43792,43836,43846,43975,43992,43994,44060,44134,44202,44228,44249,44277,44308,44329,44333,44380,44458,44525,44584,44656,44898,44903,44905,44922,45003,45127,45132,45196,45243,45251,45262,45286,45347,45355,45414,45455,45465,45469,45483,45582,45586,45598,45636,45645,45657,45682,45727,45776,45845,45883,45894,45905,45927,45945,45956,45974,46010,46033,46052,46111,46148,46290,46302,46303,46306,46420,46471,46512,46667,46736,46742,46826,46867,46947,46958,47025,47103,47159,47267,47318,47423,47470,47505,47535,47712,47727,47743,47775,47787,47816,47829,47855,47856,47945,48032,48113,48243,48300,48375,48377,48400,48429,48440,48481,48516,48540,48775,48783,48850,48893,48894,48911,48971,49100,49121,49137,49178,49189,49193,49263,49324,49333,49349,49447,49474,49493,49550,49583,49715,49743,49772,49778,49829,49850,49872,49919,49927,49928,49932,49988,50001,50014,50033,50101,50148,50157,50207,50319,50322,50379,50387,50484,50550,50588,50610,50621,50675,50676,50757,50829,50870,50982,50984,50997,51013,51025,51027,51088,51103,51133,51182,51235,51313,51332,51344,51378,51447,51493,51504,51616,51662,51730,51890,52030,52139,52236,52266,52278,52314,52343,52374,52399,52524,52527,52530,52566,52722,52899,52908,52926,52983,52999,53013,53061,53063,53084,53134,53138,53152,53165,53172,53199,53270,53303,53332,53411,53503,53508,53551,53578,53626,53636,53813,53821,53858,53927,53971,54001,54015,54054,54083,54097,54118,54230,54305,54316,54376,54441,54542,54572,54626,54660,54675,54693,54867,55034,55056,55071,55081,55094,55264,55274,55329,55354,55355,55373,55420,55422,55451,55497,55533,55537,55552,55576,55596,55692,55718,55776,55801,55825,55874,55890,55912,55989,55999,56125,56126,56127,56129,56222,56249,56266,56278,56279,56303,56361,56362,56367,56464,56504,56547,56573,56608,56656,56659,56744,56785,56824,56847,56857,56902,56920,56946,56968,57025,57050,57108,57153,57206,57230,57255,57456,57457,57597,57600,57607,57633,57790,57862,57938,57988,57997,58016,58057,58082,58128,58198,58254,58261,58269,58312,58341,58373,58398,58433,58451,58460,58492,58494,58596,58612,58631,58652,58676,58677,58693,58737,58738,58750,58815,58827,58828,58836,58861,58868,58937,58967,59105,59129,59135,59180,59184,59225,59368,59487,59517,59565,59674,59697,59749,59771,59783,59816,59870,59876,59948,59951,59964,60019,60029,60033,60076,60081,60104,60111,60123,60124,60169,60173,60198,60254,60395,60408,60457,60487,60519,60582,60583,60591,60669,60769,60777,60778,60787,60808,60817,60841,60912,60955,60967,60982,60985,60994,61016,61021,61095,61108,61173,61188,61308,61317,61321,61380,61384,61411,61495,61523,61571,61640,61649,61681,61782,61810,61861,61884,61889,61943,61985,62021,62108,62190,62259,62309,62403,62421,62464,62491,62513,62599,62633,62635,62743,62796,62817,62831,62859,62881,62897,62915,62926,62947,62958,62998,63017,63038,63046,63053,63152,63190,63245,63248,63270,63283,63318,63358,63373,63391,63520,63523,63566,63637,63727,63755,63780,63804,63838,63899,63997,64003,64021,64058,64069,64094,64099,64138,64168,64209,64213,64235,64314,64323,64326,64458,64496,64543,64561,64571,64649,64681,64716,64717,64739,64764,64765,64782,64805,64847,64912,64972,65055,65195,65203,65243,65271,65321,65437,65497,65711,65749,65857,65885,66028,66088,66161,66175,66189,66209,66244,66256,66272,66279,66366,66393,66423,66463,66464,66477,66578,66625,66657,66659,66780,66899,67047,67055,67063,67114,67175,67226,67232,67296,67301,67327,67332,67371,67384,67427,67462,67469,67518,67524,67556,67614,67791,67795,67809,67847,67848,67866,67892,67896,67929,67986,68029,68082,68124,68125,68185,68190,68262,68299,68320,68433,68447,68518,68527,68530,68548,68551,68597,68661,68672,68739,68750,68822,68924,68926,69039,69040,69069,69091,69114,69121,69151,69164,69169,69172,69195,69297,69306,69315,69363,69445,69472,69504,69523,69566,69588,69599,69609,69681,69722,69741,69861,69873,69942,69975,70018,70159,70184,70196,70242,70339,70417,70464,70548,70567,70575,70603,70628,70782,70814,70828,70850,70883,70936,70969,71012,71073,71144,71145,71158,71232,71290,71326,71342,71367,71400,71410,71415,71453,71497,71543,71615,71619,71631,71685,71713,71769,71806,71906,71954,71979,72009,72014,72128,72139,72146,72147,72156,72205,72213,72232,72281,72314,72324,72342,72343,72409,72429,72512,72560,72649,72651,72674,72708,72744,72751,72775,72885,72948,73000,73049,73068,73136,73141,73160,73169,73176,73208,73262,73277,73399,73424,73492,73533,73582,73695,73696,73718,73726,73760,73766,73867,73883,73904,73932,73959,73983,74024,74105,74119,74131,74252,74253,74285,74320,74391,74511,74606,74736,74740,74756,74757,74761,74772,74777,74828,74844,75091,75094,75102,75166,75170,75172,75183,75444,75469,75552,75631,75654,75680,75721,75738,75780,75793,75798,75810,75899,75988,75997,76058,76122,76177,76204,76216,76284,76358,76364,76370,76431,76493,76527,76572,76585,76630,76672,76720,76835,76838,76840,76866,76874,76963,77001,77072,77077,77092,77142,77205,77252,77265,77278,77286,77342,77382,77389,77439,77481,77507,77585,77605,77634,77640,77720,77721,77813,77946,77989,78079,78106,78210,78247,78249,78365,78424,78504,78506,78543,78546,78625,78639,78640,78747,78772,78794,78872,78878,78896,78977,79022,79228,79274,79293,79295,79340,79350,79373,79463,79467,79522,79547,79605,79637,79652,79701,79891,79918,80026,80032,80094,80145,80152,80165,80207,80241,80290,80317,80325,80345,80348,80359,80390,80398,80421,80428,80452,80456,80542,80590,80592,80600,80650,80661,80666,80705,80706,80722,80794,80810,80840,80876,80887,80892,81085,81090,81129,81164,81179,81183,81239,81311,81315,81459,81500,81534,81637,81713,81928,81934,81943,82033,82035,82038,82079,82101,82102,82136,82160,82176,82208,82332,82369,82408,82409,82429,82440,82449,82490,82507,82620,82717,82724,82781,82789,82827,82848,82918,82994,83009,83037,83045,83125,83157,83171,83230,83292,83308,83337,83369,83435,83464,83480,83513,83556,83617,83625,83682,83711,83760,83772,83820,83823,83834,83879,83886,83887,83944,84028,84033,84045,84140,84156,84165,84169,84200,84292,84298,84388,84428,84436,84507,84613,84645,84646,84676,84702,84725,84729,84732,84819,84961,85027,85082,85207,85214,85331,85368,85390,85460,85522,85556,85590,85632,85669,85671,85712,85745,85788,85799,85833,85924,85941,85976,85989,85995,86007,86192,86241,86273,86320,86375,86476,86494,86514,86568,86620,86708,86835,86932,86935,86936,87000,87037,87111,87150,87181,87219,87260,87286,87318,87341,87352,87400,87420,87481,87511,87533,87535,87598,87666,87686,87731,87773,87786,87821,87923,88019,88021,88025,88110,88205,88257,88399,88410,88413,88453,88468,88470,88484,88505,88550,88556,88601,88630,88643,88655,88656,88658,88747,88816,88821,88864,88884,88909,88980,88996,89057,89061,89068,89070,89102,89200,89268,89339,89410,89433,89443,89628,89694,89864,89888,89913,89928,89983,89987,90005,90007,90072,90125,90139,90151,90281,90311,90384,90520,90564,90575,90581,90634,90653,90660,90720,90765,90867,91005,91011,91052,91055,91102,91157,91195,91264,91268,91278,91415,91455,91460,91559,91567,91621,91742,91856,91866,91934,91998,92046,92060,92083,92104,92107,92108,92112,92181,92196,92276,92301,92307,92369,92371,92418,92491,92507,92543,92570,92593,92668,92710,92718,92730,92735,92749,92767,92856,92887,92894,92917,92962,93040,93181,93185,93233,93300,93311,93415,93486,93501,93523,93664,93677,93711,93778,93804,93841,93849,93853,93861,93937,93953,93964,93967,93988,94039,94088,94138,94193,94281,94298,94302,94340,94398,94541,94569,94600,94682,94730,94731,94760,94831,94839,94956,94994,95000,95017,95034,95048,95050,95054,95062,95107,95135,95147,95160,95162,95168,95173,95246,95267,95277,95294,95296,95357,95379,95465,95473,95507,95549,95581,95673,95674,95712,95739,95741,95802,95805,95814,95842,95876,95946,96012,96078,96129,96141,96153,96164,96166,96187,96235,96249,96314,96342,96403,96428,96465,96468,96474,96576,96590,96602,96643,96654,96683,96785,96790,96817,96839,96851,96974,96976,97028,97078,97128,97186,97212,97287,97348,97432,97455,97464,97485,97504,97523,97552,97589,97629,97665,97749,97788,97835,97870,97882,97885,97913,97926,97932,97981,98004,98005,98093,98097,98169,98217,98279,98313,98449,98512,98602,98833,98837,98872,98948,98981,98996,99015,99061,99086,99112,99117,99131,99149,99157,99209,99214,99313,99340,99350,99360,99373,99395,99487,99488,99514,99527,99537,99546,99562,99598,99674,99694,99707,99728,99750,99753,99793,99894,99900,99971,100275,100287,100325,100443,100520,100669,100701,100744,100759,100826,100853,100948,100954,100955,100967,101009,101022,101029,101068,101083,101168,101189,101197,101246,101266,101291,101361,101380,101424,101433,101434,101452,101518,101554,101596,101600,101608,101789,101805,101827,101911,101924,101926,101965,102079,102149,102160,102192,102222,102238,102241,102251,102259,102267,102310,102328,102422,102438,102539,102553,102568,102629,102648,102668,102695,102710,102864,102935,102979,103098,103187,103268,103311,103345,103347,103353,103382,103388,103413,103453,103480,103485,103540,103555,103630,103713,103720,103727,103761,103849,103860,103871,104013,104071,104128,104153,104157,104189,104243,104263,104327,104346,104365,104416,104556,104575,104612,104643,104703,104767,104774,104794,104855,105003,105030,105043,105240,105286,105324,105370,105401,105455,105493,105594,105641,105677,105682,105722,105785,105822,105833,105864,105876,105912,106004,106033,106052,106068,106083,106097,106279,106320,106330,106346,106397,106473,106486,106530,106570,106681,106697,106723,106861,106911,106936,106979,106993,107009,107202,107245,107247,107250,107311,107338,107405,107474,107494,107603,107720,107773,107786,107794,107934,107993,108019,108044,108063,108087,108093,108109,108114,108190,108257,108275,108323,108371,108373,108418,108439,108485,108495,108503,108529,108554,108591,108607,108653,108771,108787,108788,108811,108833,108850,108864,108869,108885,109035,109128,109129,109137,109167,109205,109213,109237,109266,109292,109317,109374,109414,109461,109527,109552,109641,109676,109686,109765,109807,109835,109843,109884,109896,109940,109970,110039,110159,110202,110260,110265,110365,110381,110513,110515,110629,110713,110752,110838,110914,110928,110950,111029,111113,111132,111170,111220,111233,111288,111290,111337,111340,111366,111370,111377,111388,111413,111441,111442,111542,111560,111599,111660,111683,111731,111803,111806,111836,111947,112001,112011,112080,112129,112361,112363,112375,112445,112504,112552,112561,112788,112802,112804,112850,112870,112884,112924,112936,112973,112977,113085,113100,113112,113124,113196,113199,113226,113232,113296,113363,113428,113440,113479,113486,113563,113680,113839,113847,113849,113865,113874,113890,113920,113953,114016,114043,114064,114121,114141,114143,114146,114165,114227,114246,114293,114358,114386,114397,114402,114403,114458,114512,114550,114603,114627,114681,114682,114754,114896,114898,114944,115081,115126,115191,115197,115219,115220,115305,115360,115382,115395,115433,115453,115525,115573,115585,115839,115883,115909,116060,116124,116200,116228,116291,116384,116398,116403,116485,116516,116576,116678,116694,116765,116776,116794,116796,116819,116821,116835,116846,116874,116881,116952,116962,117023,117037,117111,117165,117187,117191,117212,117226,117229,117261,117301,117341,117444,117459,117498,117510,117549,117681,117757,117761,117792,117798,117836,117847,117960,118035,118140,118169,118183,118195,118266,118274,118290,118316,118322,118379,118414,118416,118424,118454,118455,118464,118506,118528,118541,118564,118621,118685,118711,118715,118772,118776,118805,118834,118901,118954,118988,119011,119019,119033,119107,119108,119150,119160,119289,119338,119456,119471,119584,119648,119662,119691,119699,119704,119846,119971,119982,120066,120098,120145,120168,120282,120299,120413,120432,120504,120569,120635,120662,120684,120764,120833,120845,120884,120919,120970,121026,121071,121085,121142,121182,121191,121238,121244,121465,121540,121594,121641,121667,121689,121790,121794,121822,121825,121922,121973,121994,122034,122055,122091,122149,122209,122213,122222,122309,122381,122388,122393,122500,122507,122510,122671,122678,122708,122766,122769,122926,122939,122946,122981,123042,123049,123124,123156,123218,123231,123279,123331,123392,123429,123459,123511,123540,123559,123566,123568,123579,123611,123646,123667,123751,123811,123865,123994,124004,124005,124146,124159,124207,124219,124278,124290,124306,124317,124343,124532,124659,124800,124827,124829,124928,124965,124967,125053,125073,125114,125223,125279,125315,125363,125372,125447,125490,125494,125506,125537,125581,125610,125686,125767,125826,125836,125913,125969,126007,126012,126030,126038,126044,126051,126070,126135,126198,126204,126237,126244,126306,126326,126341,126342,126390,126406,126491,126551,126589,126598,126600,126646,126701,126736,126828,126842,126872,126898,126919,126953,126983,127028,127038,127073,127193,127248,127294,127307,127315,127327,127510,127625,127637,127650,127677,127738,127747,127846,127918,128044,128070,128073,128090,128116,128125,128194,128217,128222,128234,128248,128345,128405,128413,128522,128557,128580,128599,128615,128683,128768,128772,128791,128867,128887,128937,128947,128951,128990,129014,129081,129083,129084,129088,129100,129161,129177,129225,129235,129249,129319,129344,129357,129373,129375,129407,129447,129503,129509,129518,129596,129632,129643,129682,129838,129867,129872,129889,129994,130003,130101,130119,130129,130213,130283,130334,130341,130342,130343,130345,130517,130584,130632,130646,130723,130827,130897,130957,131027,131048,131070,131082,131121,131143,131261,131266,131292,131387,131438,131447,131588,131591,131592,131622,131668,131710,131715,131756,131778,131842,131846,131888,132043,132118,132125,132194,132365,132392,132394,132413,132418,132476,132526,132549,132589,132705,132864,132886,132908,132924,132936,132943,132963,133039,133049,133050,133079,133096,133129,133209,133293,133366,133414,133465,133481,133572,133675,133710,133745,133750,133824,133880,133977,133978,133992,134014,134094,134096,134143,134152,134162,134185,134208,134227,134357,134362,134373,134430,134456,134482,134496,134560,134569,134575,134579,134599,134641,134683,134710,134711,134721,134751,134797,134830,134859,134863,134926,134995,135001,135040,135075,135133,135151,135191,135237,135283,135284,135328,135329,135363,135380,135396,135400,135538,135632,135659,135881,135955,135957,135981,135996,136050,136107,136125,136126,136132,136173,136209,136246,136267,136278,136314,136421,136496,136498,136530,136572,136635,136661,136680,136732,136814,136882,136915,137034,137067,137069,137102,137209,137244,137268,137292,137313,137329,137339,137359,137363,137369,137395,137435,137444,137474,137498,137600,137626,137637,137685,137690,137709,137867,137890,137924,137931,137959,137977,137984,138089,138102,138215,138223,138251,138352,138419,138444,138447,138525,138629,138691,138695,138729,138805,138857,138863,138874,139005,139013,139058,139139,139153,139268,139285,139290,139352,139355,139425,139427,139526,139531,139536,139581,139629,139630,139663,139754,139827,139918,139943,139989,139993,140102,140106,140120,140153,140162,140176,140208,140219,140261,140265,140268,140292,140310,140358,140367,140447,140522,140535,140537,140582,140709,140721,140725,140788,140823,140828,140856,140900,140915,140926,140937,140940,140941,140975,140986,140993,141074,141162,141185,141211,141334,141355,141376,141428,141539,141628,141749,141862,141867,142197,142218,142334,142339,142385,142393,142507,142524,142550,142646,142648,142686,142699,142732,142744,142807,142809,142909,142925,143038,143166,143168,143187,143191,143247,143272,143386,143477,143591,143670,143674,143687,143765,143800,143855,143959,143962,144023,144127,144231,144243,144294,144303,144338,144384,144394,144423,144431,144515,144541,144553,144578,144584,144730,144782,144792,144801,144833,144880,144906,145056,145111,145186,145188,145197,145295,145302,145313,145336,145402,145478,145501,145561,145607,145653,145778,145890,145911,145933,145934,145944,145954,145968,145977,146006,146029,146112,146148,146266,146277,146329,146348,146366,146412,146417,146427,146477,146507,146512,146530,146545,146637,146667,146688,146732,146764,146776,146873,146934,146936,147003,147070,147076,147162,147174,147199,147202,147218,147236,147358,147431,147476,147576,147581,147599,147604,147622,147699,147705,147726,147751,147762,147773,147783,147854,147885,147983,148023,148038,148075,148145,148152,148198,148207,148217,148381,148474,148539,148665,148676,148704,148725,148739,148760,148792,148835,148877,148890,148929,148935,148940,149053,149067,149115,149157,149206,149219,149270,149328,149376,149423,149488,149520,149604,149631,149632,149651,149672,149706,149715,149739,149752,149869,149963,150038,150074,150092,150095,150167,150237,150252,150258,150396,150514,150585,150713,150733,150871,150876,150899,150913,150914,150993,151042,151064,151141,151211,151212,151347,151383,151398,151455,151461,151485,151493,151504,151506,151517,151521,151545,151546,151633,151660,151665,151792,151798,151802,151803,151908,151931,152000,152070,152100,152114,152125,152146,152186,152200,152217,152219,152274,152415,152416,152436,152473,152481,152503,152518,152519,152551,152579,152602,152605,152616,152699,152747,152754,152848,152854,152967,152991,153034,153044,153072,153132,153133,153209,153213,153291,153366,153545,153551,153570,153667,153671,153674,153694,153842,153858,153862,153951,153954,153990,154001,154006,154012,154022,154024,154130,154154,154283,154309,154313,154403,154414,154454,154527,154625,154731,154742,154775,154794,154799,154813,154825,154861,154981,155033,155054,155120,155126,155198,155218,155253,155265,155284,155329,155457,155563,155595,155614,155769,156030,156047,156062,156149,156212,156256,156278,156419,156424,156495,156517,156523,156577,156579,156594,156604,156613,156647,156695,156725,156732,156749,156752,156758,156900,156943,156951,156984,157037,157062,157064,157077,157227,157300,157410,157427,157652,157653,157666,157708,157746,157787,157821,157861,157872,157886,157907,157909,157923,157977,158013,158017,158022,158023,158048,158082,158100,158220,158284,158302,158381,158401,158424,158494,158507,158518,158547,158561,158661,158733,158737,158740,158743,158771,158778,158887,158901,158955,158962,158967,158969,159003,159026,159098,159152,159158,159166,159210,159274,159349,159380,159451,159482,159490,159576,159595,159598,159609,159635,159656,159678,159775,159916,159917,160008,160027,160041,160117,160184,160244,160313,160327,160332,160345,160391,160431,160459,160460,160492,160496,160505,160565,160572,160599,160608,160643,160686,160781,160842,160867,160878,160897,160900,160910,160943,160958,161003,161040,161057,161058,161059,161082,161122,161134,161151,161167,161235,161299,161314,161360,161391,161411,161465,161481,161542,161582,161584,161594,161670,161696,161716,161723,161728,161839,161899,161933,161962,162070,162096,162199,162205,162240,162251,162388,162440,162442,162572,162707,162708,162754,162758,162959,162994,163005,163041,163043,163071,163079,163098,163130,163199,163276,163287,163377,163438,163499,163534,163600,163703,163755,163763,163872,163935,164019,164080,164119,164256,164262,164295,164337,164338,164556,164635,164637,164640,164641,164684,164708,164763,164828,164885,164894,164920,165014,165053,165084,165119,165186,165213,165397,165399,165427,165433,165521,165563,165612,165675,165730,165789,165870,165920,165967,166030,166034,166036,166108,166131,166216,166286,166301,166304,166339,166439,166464,166474,166486,166505,166533,166549,166643,166658,166671,166736,166801,166840,166883,166937,166950,166970,167045,167088,167093,167122,167128,167157,167171,167214,167215,167361,167496,167543,167573,167579,167615,167636,167645,167660,167671,167717,167721,167734,167783,167794,167795,167825,167853,167942,168041,168062,168083,168134,168361,168437,168507,168511,168613,168628,168691,168707,168709,168953,168985,169025,169095,169208,169214,169217,169247,169303,169317,169406,169447,169561,169563,169597,169612,169665,169727,169836,169838,170031,170106,170140,170162,170207,170247,170335,170341,170355,170373,170417,170474,170480,170493,170613,170729,170806,170827,170841,170868,170908,170950,170998,171234,171309,171356,171374,171381,171395,171399,171404,171429,171466,171492,171567,171588,171633,171650,171658,171683,171731,171790,171838,171903,171915,171965,171971,172006,172012,172134,172192,172287,172293,172302,172312,172400,172443,172472,172481,172484,172494,172509,172581,172585,172659,172662,172675,172678,172818,172854,172890,172896,172902,172904,172937,172984,173009,173043,173107,173126,173237,173270,173271,173310,173321,173362,173490,173519,173547,173552,173564,173635,173684,173701,173836,173876,173936,174055,174074,174076,174130,174182,174187,174190,174279,174333,174367,174414,174419,174433,174496,174518,174539,174665,174670,174702,174715,174723,174753,174761,174800,174819,174877,174893,174898,174917,174924,174948,175021,175043,175072,175202,175355,175368,175377,175398,175526,175584,175603,175645,175651,175670,175693,175702,175726,175753,175820,175855,175865,175891,175905,175991,175997,176044,176070,176119,176120,176165,176172,176179,176276,176307,176310,176406,176510,176512,176516,176521,176527,176625,176687,176732,176736,176753,176943,176952,176981,177029,177121,177129,177198,177225,177300,177325,177355,177364,177406,177410,177446,177452,177460,177480,177544,177592,177599,177706,177744,177777,177779,177818,177833,177945,177951,177952,177995,178042,178104,178112,178125,178146,178155,178195,178206,178218,178255,178340,178424,178436,178498,178589,178601,178615,178660,178756,178759,178771,178853,178879,178925,178932,179096,179176,179263,179265,179266,179275,179381,179389,179392,179402,179458,179503,179532,179550,179610,179640,179686,179703,179705,179723,179750,179771,179779,179812,179843,179915,179999,180030,180037,180062,180109,180128,180131,180173,180181,180263,180301,180327,180367,180429,180518,180541,180643,180649,180652,180670,180682,180717,180844,180952,180966,180981,180997,181001,181088,181156,181209,181255,181267,181366,181422,181447,181490,181493,181512,181646,181656,181765,181780,181786,181889,181916,181967,182112,182242,182266,182327,182396,182409,182414,182427,182440,182521,182549,182559,182568,182637,182714,182716,182738,182770,182954,182970,183015,183025,183106,183131,183156,183177,183201,183211,183271,183434,183462,183465,183471,183481,183532,183538,183572,183594,183671,183703,183801,183808,183824,183894,183940,183995,184006,184014,184072,184096,184099,184165,184219,184248,184274,184383,184403,184466,184516,184574,184602,184705,184713,184758,184831,184844,184889,184902,185003,185045,185104,185182,185186,185207,185222,185237,185241,185251,185308,185316,185320,185359,185366,185380,185398,185420,185604,185633,185655,185702,185732,185734,185775,185898,185917,185947,185965,186007,186026,186089,186177,186202,186276,186338,186347,186355,186362,186382,186419,186439,186507,186608,186642,186658,186688,186795,186891,186895,186911,187071,187075,187161,187179,187196,187248,187287,187393,187525,187578,187657,187672,187678,187725,187825,187873,187929,187948,187990,187999,188010,188026,188037,188040,188124,188134,188142,188174,188266,188277,188305,188335,188373,188383,188510,188564,188590,188677,188704,188720,188725,188730,188762,188768,188781,188838,188877,188977,188999,189155,189171,189239,189367,189382,189492,189565,189598,189675,189689,189723,189754,189837,189851,189895,189929,190059,190085,190131,190141,190225,190231,190242,190247,190248,190262,190263,190280,190284,190302,190329,190353,190461,190496,190502,190511,190516,190548,190621,190657,190679,190692,190694,190850,190915,190990,190991,191005,191007,191039,191059,191075,191081,191084,191086,191133,191140,191273,191328,191426,191452,191634,191675,191690,191763,191802,191852,191875,192039,192118,192152,192249,192259,192278,192295,192368,192370,192436,192463,192466,192602,192624,192630,192670,192697,192718,192728,192795,192858,192879,192923,192924,192928,192947,192987,193020,193105,193154,193169,193171,193251,193286,193322,193542,193550,193574,193610,193760,193817,193824,193927,193948,193960,194020,194028,194101,194139,194264,194333,194374,194503,194552,194582,194589,194651,194667,194672,194682,194741,194828,194840,194841,194856,195014,195024,195061,195115,195296,195298,195300,195318,195485,195513,195595,195818,195840,195873,195916,196014,196075,196079,196110,196129,196180,196183,196206,196214,196235,196316,196342,196360,196383,196402,196418,196468,196483,196507,196531,196553,196560,196580,196582,196620,196641,196657,196683,196698,196714,196721,196793,196844,196855,196948,196993,197018,197100,197139,197159,197193,197223,197303,197316,197327,197330,197346,197378,197445,197565,197579,197618,197629,197639,197685,197686,197711,197733,197736,197760,197801,197823,197881,197903,197912,197945,197975,197986,197998,198039,198046,198065,198066,198077,198085,198087,198126,198133,198135,198152,198204,198226,198229,198269,198365,198389,198394,198415,198417,198463,198466,198490,198494,198520,198524,198533,198535,198609,198636,198662,198668,198669,198779,198789,198814,198821,198829,198838,198874,198942,198954,199043,199129,199188,199197,199217,199229,199255,199259,199306,199438,199491,199514,199578,199581,199635,199703,199744,199752,199769,199889,199983)
    ##   are outliers with |weight| <= 2.7e-07 ( < 5e-07); 
    ##  16029 weights are ~= 1. The remaining 179173 ones are summarized as
    ##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
    ## 0.0000011 0.8574000 0.9515000 0.8664000 0.9857000 0.9990000 
    ## Algorithmic parameters: 
    ##        tuning.chi                bb        tuning.psi        refine.tol 
    ##         1.548e+00         5.000e-01         4.685e+00         1.000e-07 
    ##           rel.tol         scale.tol         solve.tol          zero.tol 
    ##         1.000e-07         1.000e-10         1.000e-07         1.000e-10 
    ##       eps.outlier             eps.x warn.limit.reject warn.limit.meanrw 
    ##         5.000e-07         3.693e-11         5.000e-01         5.000e-01 
    ##      nResample         max.it         groups        n.group       best.r.s 
    ##            500             50              5            400              2 
    ##       k.fast.s          k.max    maxit.scale      trace.lev            mts 
    ##              1            200            200              0           1000 
    ##     compute.rd fast.s.large.n 
    ##              0           2000 
    ##                   psi           subsampling                   cov 
    ##            "bisquare"         "nonsingular"         ".vcov.avar1" 
    ## compute.outlier.stats 
    ##                  "SM" 
    ## seed : int(0)

``` r
coef(lm_model)
```

    ##   (Intercept) trip_distance 
    ##     12.561587      4.613976

``` r
coef(robust_model)
```

    ##   (Intercept) trip_distance 
    ##     11.447520      4.789698

``` r
predict(lm_model,
        data.frame(trip_distance = 80))
```

    ##        1 
    ## 381.6797

``` r
predict(robust_model,
        data.frame(trip_distance = 80))
```

    ##        1 
    ## 394.6233

If robust slope smaller:

OLS slope is inflated by extreme values. Robust regression downweights
outliers.

Interpret:

Robust model provides more conservative predictions at large distances.

``` r
taxi_model <- taxi_model %>%
  mutate(
    quarter = case_when(
      month %in% c("1","2","3") ~ "Q1",
      month %in% c("4","5","6") ~ "Q2",
      month %in% c("7","8","9") ~ "Q3",
      TRUE ~ "Q4"
    )
  )

quarter_slopes <- taxi_model %>%
  group_by(quarter) %>%
  nest() %>%
  mutate(
    model = map(data, ~ lm(total_amount ~ trip_distance, data = .x)),
    tidy  = map(model, tidy)
  ) %>%
  unnest(tidy)

quarter_slopes
```

    ## # A tibble: 8 × 8
    ## # Groups:   quarter [4]
    ##   quarter data                  model term  estimate std.error statistic p.value
    ##   <chr>   <list>                <lis> <chr>    <dbl>     <dbl>     <dbl>   <dbl>
    ## 1 Q4      <tibble [53,027 × 8]> <lm>  (Int…    13.2    0.0404       328.       0
    ## 2 Q4      <tibble [53,027 × 8]> <lm>  trip…     4.65   0.00824      565.       0
    ## 3 Q3      <tibble [44,417 × 8]> <lm>  (Int…    12.6    0.0417       302.       0
    ## 4 Q3      <tibble [44,417 × 8]> <lm>  trip…     4.59   0.00801      573.       0
    ## 5 Q2      <tibble [53,496 × 8]> <lm>  (Int…    12.5    0.0361       346.       0
    ## 6 Q2      <tibble [53,496 × 8]> <lm>  trip…     4.62   0.00699      660.       0
    ## 7 Q1      <tibble [49,060 × 8]> <lm>  (Int…    11.8    0.0333       356.       0
    ## 8 Q1      <tibble [49,060 × 8]> <lm>  trip…     4.59   0.00670      685.       0

``` r
ggplot(taxi_model,
       aes(trip_distance,
           total_amount,
           color = quarter)) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Seasonal Fare-Distance Comparison")
```

    ## `geom_smooth()` using formula = 'y ~ x'

![](FA3-Espiritu,-Clores_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

Differences in slopes across quarters suggest seasonal variation in
marginal fare pricing, potentially due to congestion, demand, or
operational adjustments.

Linear modeling is inadequate when the relationship between variables is
nonlinear or when error variance is not constant. In the taxi dataset,
while trip distance strongly predicts total fare, residual plots
indicate increasing variability at larger distances, violating
homoskedasticity assumptions. Flexible regression methods such as LOESS
allow the model to adapt locally and capture curvature that a single
linear slope cannot represent. Large urban datasets also contain extreme
values that disproportionately influence ordinary least squares because
OLS minimizes squared residuals. These influential observations can
distort slope estimates and predictions. Robust regression mitigates
this issue by down-weighting extreme residuals, resulting in more stable
parameter estimates. Combining classical, flexible, and robust
approaches provides a deeper understanding of fare dynamics and ensures
more reliable predictive performance.
